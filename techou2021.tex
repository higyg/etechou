\documentclass[9pt]{article}

\usepackage[palette=spring,year=2021]{ctechou}

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% yearly page                                                             
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% parameters:
% 1. Year
\NewDocumentCommand{\drawyearlypage}{m}{%
  \newpage
  \phantomsection\label{page:Y#1}
  \drawsidebar{#1}{100}
  \drawquarterlyhead{A NICE YEAR!}\\
  \begin{minipage}[t]{0.9\linewidth}
    \begin{tikzpicture}
      \clip (-2, 1.0) rectangle (25,-9.5);
      % \draw[help lines,step=1,green!25!black!25!white] (0, 0) grid (25, -9);
      \calendar[dates=#1-01-01 to #1-12-31,
      at={(1, 0)},
      month list,
      month label left,
      day xshift=1.8em,
      month yshift=2.25em,
      day text={ \hyperref[page:Y\%y0-M\%m0-D\%d0]{\%d-}},
      month text=\textcolor{cola!30!black!20}{\textit{ \hyperref[page:Y\%y0-M\%m0]{\%mt} }}]
      if (Sunday) [black!50]
      if (Saturday) [black!50]
      ;
    \end{tikzpicture}
  \end{minipage}\\
  \begin{minipage}[t]{1.0\linewidth}
    \input{./tex/yearly_tasks.tex}
  \end{minipage}
}
\drawyearlypage{2021}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% quarterly pages                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% parameters:
% 1. Year
% 2. Quarter (13 - 1, 14 -2, 15 - 3, 16 - 4)
% 3. Name
\NewDocumentCommand{\drawquarterlypage}{mmm}{%
  \newpage
  \phantomsection\label{page:Y#1-Q#2}
  \drawsidebar{#1}{#2}
  \drawquarterlyhead{#3}\\
  \begin{minipage}[t]{0.5\linewidth}
    \drawquarterlytimeline{#2}
  \end{minipage}%
  \begin{minipage}[t]{0.5\linewidth}
    \input{./tex/quarterly_tasks.tex}\\
  \end{minipage}
}

\drawquarterlypage{2021}{13}{Quarter 1}
\drawquarterlypage{2021}{14}{Quarter 2}
\drawquarterlypage{2021}{15}{Quarter 3}
\drawquarterlypage{2021}{16}{Quarter 4}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% monthly pages                                                               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% parameters:
% 1. Year
% 2. Month
% 3. # first week
\NewDocumentCommand{\drawmonthlypage}{mmm}{%
  \newpage
  \phantomsection\label{page:Y#1-M#2}
  \drawsidebar{#1}{#2}
  \drawmonthlyhead{#2}\\
  \begin{minipage}[t]{0.70\linewidth}
    \begin{tabularx}{0.95\linewidth}{m{\linewidth}}
      \drawmonthlycal{#1}{#2}{#3}
    \end{tabularx}\\
  \end{minipage}%
  \begin{minipage}[t]{0.25\linewidth}
    \input{./tex/monthly_tasks.tex}\\
  \end{minipage}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% weekly pages                                                                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% parameters:
% 1. Year
% 2. Month
% 3. Day
% 4. Week in this month
% 5. Week in this year
\NewDocumentCommand{\drawweeklypage}{mmmmm}{%
  \newpage
  \phantomsection\label{page:Y#1-W#5}
  \drawsidebar{#1}{#2}
  \drawweeklyhead{#2}{#4}
  \drawweeklycorner{#5}
  \begin{minipage}[t]{0.5\linewidth}
    \begin{tabularx}{0.95\linewidth}{m{\linewidth}}
      \drawweeklytimeline{#1}{#2}{#3}
    \end{tabularx}
  \end{minipage}%
  \begin{minipage}[t]{0.45\linewidth}
    \input{./tex/weekly_tasks.tex}
  \end{minipage}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   daily pages                                                                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   parameters:
%   1. Year
%   2. Month
%   3. Date
\NewDocumentCommand{\drawdailypage}{mmm}{%
  \newpage
  \phantomsection\label{page:Y#1-M#2-D#3}
  \drawsidebar{#1}{#2}
  \drawmonthline{#1}{#2}{#3}
  \drawdailycorner{#1}{#2}{#3}
  \begin{minipage}[t]{0.5\linewidth}
    \input{./tex/daily_time_table.tex}
  \end{minipage}%
  \begin{minipage}[t]{0.45\linewidth}
    \input{./tex/daily_tasks.tex}
  \end{minipage}\\
}




\newcount\mycnt
\DTMsaveddatetojulianday{techoufirstday}{\mycnt}

\tikzmath{\tmpW=int(0);}
\foreach \i in {-3,...,368} {
  \advance\mycnt by \i
  \pgfcalendarjuliantodate{\mycnt}{\tmpy}{\tmpm}{\tmpd}
  \pgfcalendarifdate{\tmpy-\tmpm-\tmpd}{day of month=1}{
    \tikzmath{
      \tmpW=int((\i + \DTMfetchdow{techoufirstday})/ 7);
    }
    \drawmonthlypage{\tmpy}{\tmpm}{\tmpW}
  }{}
  \pgfcalendarifdate{\tmpy-\tmpm-\tmpd}{Monday}{
    \tikzmath{
      \tmpW=int(\i / 7 + 1);
      \tmpw=int(int{\tmpd.0} / 7 + 1);
    }
    \drawweeklypage{\tmpy}{\tmpm}{\tmpd}{\tmpw}{\tmpW}
  }{}
  \drawdailypage{\tmpy}{\tmpm}{\tmpd}
}


\end{document}
